# Device Sandbox Simulator

A dragâ€‘andâ€‘drop web app where you can place virtual **Light** and **Fan** devices onto a canvas, tweak their controls, and **save / load presets**.  
Frontend is built with **React + Tailwind + React DnD**; backend is **Laravel + MySQL**.

---

## âœ¨ Features

- Drag devices (Light, Fan) from the sidebar into a **Testing Canvas**.
- Device controllers:
  - **Light**: power toggle, color temperature (warm/neutral/cool/pink), brightness (0â€“100) with live glow visuals.
  - **Fan**: power toggle, speed (0â€“100) with live spin animation.
- **Save presets** to the database and **load** them later from the sidebar.
- **Persistence**: current device state in `localStorage`; presets in **MySQL** via API.
- **Delete presets** from the database and update the sidebar.
- Clean, modular React components with Context for state management.

---

## ğŸ§± Tech Stack

- **Frontend**: React, Vite, Tailwind CSS, React DnD, Axios
- **Backend**: Laravel (PHP), MySQL
- **State**: React Context (+ reducer for current device settings)
- **API**: REST (JSON), CORS enabled

---

## ğŸ“ Project layout (high level)

```
frontend/
  src/
    components/         # UI components (Canvas, Light, Fan, Buttons etc.)
    contexts/           # CurrentDeviceContext, PresetsContext, SidebarContext
    data/               # static device/color data where applicable
    hooks/              # Custom hooks
    Layout              # Components for layout
    main.jsx, App.jsx
    services            # api service
  index.html, tailwind config, etc.

backend/ (Laravel project root)
  app/
    Http/Controllers/Api/   # PresetController, DeviceController
    Models/                 # Preset, Device
  database/
    migrations/             # devices + presets tables (devices inserted by migration)
  routes/api.php
  config/cors.php
```

> **Note**: In this implementation, `devices` are fixed (Light/Fan) and inserted directly in a migration. Presets capture **one device** per row (name, type/device, settings JSON).

---

## âœ… Prerequisites

- Node.js â‰¥ 18 and npm
- PHP â‰¥ 8.2
- Composer
- MySQL â‰¥ 8.0 (or higher)

---

## ğŸ›  Backend Setup (Laravel + MySQL)

1. **Create DB & configure `.env`**

Create a MySQL database (e.g. `devices_sandbox`) and update `backend/.env`:

```env
APP_URL=http://127.0.0.1:8000
APP_ENV=local
APP_KEY=base64:...        # generated by artisan
APP_DEBUG=true

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=devices_sandbox
DB_USERNAME=root
DB_PASSWORD=secret
```

2. **Install & keygen**

```bash
cd backend
composer install
php artisan key:generate
```

3. **Migrate** (includes inserting Light/Fan rows in the `devices` table)

```bash
php artisan migrate
```

4. **Run the API**

```bash
php artisan serve
# => http://127.0.0.1:8000
```

5. **CORS** (already configured for Vite dev defaults)
   Check `config/cors.php` includes your frontend origin (e.g. `http://localhost:5173` and `http://127.0.0.1:5173`).

```php
'paths' => ['api/*', 'sanctum/csrf-cookie'],
'allowed_methods' => ['*'],
'allowed_origins' => ['http://localhost:5173','http://127.0.0.1:5173'],
'allowed_headers' => ['*'],
'supports_credentials' => false,
```

---

## ğŸ’» Frontend Setup (React + Vite)

1. **Install deps**

```bash
cd frontend
npm install
```

2. **Create `.env`** with your API base URL

```env
# Vite env
VITE_API_URL=http://127.0.0.1:8000/api

```

3. **Start dev server**

```bash
npm run dev
# => http://localhost:5173 (default)
```

4. **Build for production**

```bash
npm run build
npm run preview # optional local preview
```

---

## ğŸ”Œ API Reference (summary)

### Devices (catalog)

- `GET /api/devices` â†’ returns fixed device rows: `light`, `fan` (inserted via migration).

### Presets

- `GET /api/presets` â†’ list presets (paginated)
- `GET /api/presets/{id}` â†’ show one preset
- `POST /api/presets` â†’ create preset
- `PUT /api/presets/{id}` â†’ update name/settings
- `DELETE /api/presets/{id}` â†’ delete

#### Create LIGHT preset (example)

```http
POST /api/presets
Content-Type: application/json

{
  "name": "Warm 70",
  "type": "light",
  "settings": { "isOn": true, "brightness": 70, "colorId": 1 }
}
```

#### Create FAN preset (example)

```http
POST /api/presets
{
  "name": "Fan 60",
  "type": "fan",
  "settings": { "isOn": true, "speed": 60 }
}
```

> **Validation** (backend):
>
> - `type` must be `light` or `fan`.
> - Light requires `isOn`, `brightness (0â€“100)`, `colorId`.
> - Fan requires `isOn`, `speed (0â€“100)`.
> - Irrelevant fields are **prohibited** (e.g., `speed` on a light).

---

## ğŸ§­ Using the App

1. Drag **Light** or **Fan** from the sidebar to the **Testing Canvas**.
2. Use the controller panel to adjust settings.
   - Light: toggle power, pick color temp, adjust brightness.
   - Fan: toggle power, adjust speed.
3. Click **Save Preset** â†’ name it â†’ it appears under **Saved Presets**.
4. Click (or drag) a preset to load it back into the canvas.

**Persistence**

- Current device (working state): `localStorage`
- Presets: **MySQL** via Laravel API

---

## ğŸš€ Deployment Notes (quick)

- **Frontend**: `npm run build` â†’ deploy the `dist/` folder to static hosting (or cPanel subdir).
- **Backend** (Laravel): deploy via your PHP hosting; set document root to `/public`, configure `.env`, run `php artisan migrate --force`.
- Ensure **CORS** allows your production frontend domain.

---

## ğŸ§ª Quick cURL Test

```bash
# Create light preset
curl -s -X POST http://127.0.0.1:8000/api/presets  -H "Content-Type: application/json"  -d '{"name":"Warm 70","type":"light","settings":{"isOn":true,"brightness":70,"colorId":1}}' | jq

# List
curl -s http://127.0.0.1:8000/api/presets | jq

# Show
curl -s http://127.0.0.1:8000/api/presets/1 | jq
```

---

## ğŸ› Troubleshooting

- **CORS blocked**: confirm `config/cors.php` `allowed_origins` matches your Vite/host URL. `php artisan config:clear` after changes.
- **422 validation**: make sure the payload matches `type` requirements (light vs fan) and no extra fields are sent.
- **Laravel 500**: check `storage/logs/laravel.log`.
- **Env mismatch**: frontâ€™s `VITE_API_URL` must match backend `/api` base URL.

---

## ğŸ—„ï¸ SQL (optional quick dump)

```sql
-- devices (fixed entries)
INSERT INTO devices (id, type, name, default_settings, created_at, updated_at) VALUES
  (1,'light','Light','{"isOn":false,"brightness":70,"colorId":1}', NOW(), NOW()),
  (2,'fan','Fan','{"isOn":false,"speed":64}', NOW(), NOW());
```
